# Capítulo 11: Manipulação de Arquivos e I/O

Leitura, Fechamento e escrita de arquivos com `io.open`, `io.read`, `io.write`, `file:read`, `file:close`.

Modos de abertura `io.open`:

-   `r`: modo de leitura (o padrão)
-   `w`: modo de escrita
-   `a`: modo de adição
-   `r+`: modo de atualização, todos os dados anteriores são preservados
-   `w+`: modo de atualização, todos os dados anteriores são apagados
-   `a+`: modo de atualização de adição, todos os dados anteriores são preservados, a escrita somente é permitida no fim do arquivo
-   `b` é necessário em alguns sistemas para abrir o arquivo em modo binário

Modos de abertura `file:read`:

-   `*n`: lê um número; este é o único formato que retorna um número ao invés de uma cadeia.
-   `*a`: lê o arquivo inteiro, começando na posição corrente. no fim do arquivo, retorna a cadeia vazia.
-   `*l`: lê a próxima linha pulando o fim de linha, retornando nil no fim do arquivo. Este é o formato padrão.
-   `*L`: lê a próxima linha mantendo o fim de linha (se presente), retornando nil no fim do arquivo.
-   `number`: lê uma cadeia com até esse número de bytes, retornando nil no fim do arquivo. Se number é zero, não lê nada e retorna uma cadeia vazia, ou nil no fim do arquivo.

## Exemplo 1: Leitura de arquivo Inteiro

```sh
# criando um arquivo
echo -e "Ola\nLUA" > saudacao.txt
```

```lua
local arquivo = io.open("saudacao.txt", "r")

if arquivo then
    local conteudo = arquivo:read("*a") -- Lê todo o conteúdo
    print("Conteúdo do arquivo: \n" .. conteudo)
    arquivo:close() -- Fecha o arquivo
else
    error("Erro ao abrir o arquivo para leitura.")
end
--[[ Conteúdo do arquivo:
     Ola
     LUA
]]
```

## Exemplo 2: Escrita de arquivo

```lua
-- Abre o arquivo "saudacao.txt" para escrita ("w") substituindo tudo conteúdo existente, se nao cria um novo arquivo
local file = io.open("saudacao.txt", "w")

if file then
    file:write("Olá do script Lua!\n")
    file:write("Esta é a segunda linha.\n")
    file:close() -- Fecha o arquivo
    print("Arquivo saudacao.txt criado/alterado com sucesso.")
else
    error("Erro ao abrir o arquivo para escrita.")
end
--[[ Conteúdo do arquivo:
     Olá do script Lua!
     Esta é a segunda linha.
]]
```

## Exemplo 3: Lendo um Arquivo Linha por Linha

```lua
local file = io.open("saudacao.txt", "r")

if file then
    print("Conteúdo de saudacao.txt")

    for linha in file:lines() do -- Método mais idiomático para ler linha por linha
        print(linha)
    end

    file:close()
else
    error("Erro ao abrir o arquivo para leitura.")
end
```

## Exemplo 4: Lendo Entrada do Usuário:

```lua
io.write("Por favor, digite seu nome: \n")
local nome_usuario = io.read("*l") -- Lê uma linha da entrada padrão
print("Olá, " .. nome_usuario .. "!")
```

## Exemplo 5: Anexando Conteúdo a um Arquivo `a`

```lua
local file = io.open("saudacao.txt", "a") -- Abre para anexar

if file then
    file:write("Esta linha foi anexada.\n")
    file:close()
    print("Conteúdo anexado a saudacao.txt.")
else
    error("Erro ao abrir o arquivo para anexar.")
end
--[[ Conteúdo do arquivo:
     Olá do script Lua!
     Esta é a segunda linha.
     Esta linha foi anexada.
]]
```
