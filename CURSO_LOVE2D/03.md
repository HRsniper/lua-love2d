# üéÆ Cap√≠tulo 3: Estrutura de um Jogo com L√ñVE

## üéØ Objetivo

Compreender o ciclo de vida de um jogo em L√ñVE2D e como organizar o c√≥digo usando as fun√ß√µes principais: `love.load`, `love.update` e `love.draw`.

## üîÑ 3.1 Ciclo de Vida do Jogo

L√ñVE2D chama automaticamente tr√™s fun√ß√µes principais:

| Fun√ß√£o            | Quando √© chamada                      |
| ----------------- | ------------------------------------- |
| `love.load()`     | Uma vez, no in√≠cio do jogo            |
| `love.update(dt)` | A cada frame, para atualizar a l√≥gica |
| `love.draw()`     | A cada frame, para desenhar na tela   |

### O que √© Delta Time (dt)?

Delta time √© o tempo (em segundos) que passou desde a √∫ltima atualiza√ß√£o. Isso garante que o jogo rode na mesma velocidade, independentemente do FPS do computador.

**Exemplo:**

-   Se o jogo roda a 60 FPS: `dt ‚âà 0.016` segundos
-   Se o jogo roda a 30 FPS: `dt ‚âà 0.033` segundos

## üß™ 3.2 Exemplo B√°sico

```lua
function love.load()
    x = 100
    velocidade = 200  -- pixels por segundo
end

function love.update(dt)
    x = x + velocidade * dt
end

function love.draw()
    love.graphics.circle("fill", x, 300, 30)
end
```

### üîç Explica√ß√£o:

-   `x` √© a posi√ß√£o horizontal do c√≠rculo
-   `velocidade` define quantos pixels por segundo o objeto se move
-   `dt` (delta time) garante movimento suave em qualquer computador

### Por que usar Delta Time?

```lua
-- ‚ùå ERRADO - velocidade depende do FPS
function love.update(dt)
    x = x + 5  -- sempre move 5 pixels por frame
end

-- ‚úÖ CORRETO - velocidade consistente
function love.update(dt)
    x = x + velocidade * dt  -- move baseado no tempo
end
```

## üß† 3.3 Separando Responsabilidades

Organizar o c√≥digo por fun√ß√£o ajuda na manuten√ß√£o e expans√£o do jogo.

### Estrutura Organizada

```lua
-- Vari√°veis globais (ou melhor ainda, locais)
local jogador = {}

function love.load()
    -- INICIALIZA√á√ÉO: Configure valores iniciais
    jogador = {
        x = 100,
        y = 100,
        velocidade = 150,
        largura = 50,
        altura = 50,
        cor = {1, 0, 0}  -- vermelho
    }

    -- Configura√ß√µes da tela
    love.window.setTitle("Meu Primeiro Jogo")
end

function love.update(dt)
    -- L√ìGICA: Atualize posi√ß√µes, colis√µes, etc.
    jogador.x = jogador.x + jogador.velocidade * dt

    -- Manter o jogador na tela
    if jogador.x > love.graphics.getWidth() then
        jogador.x = -jogador.largura
    end
end

function love.draw()
    -- RENDERIZA√á√ÉO: Desenhe tudo na tela
    love.graphics.setColor(jogador.cor)
    love.graphics.rectangle("fill", jogador.x, jogador.y, jogador.largura, jogador.altura)

    -- Reset da cor para branco
    love.graphics.setColor(1, 1, 1)
end
```

## üéÆ 3.4 Intera√ß√£o com o Usu√°rio

### Entrada Cont√≠nua vs. Eventos

```lua
-- love.update() - para a√ß√µes cont√≠nuas
function love.update(dt)
    if love.keyboard.isDown("right") then
        jogador.x = jogador.x + jogador.velocidade * dt
    end
    if love.keyboard.isDown("left") then
        jogador.x = jogador.x - jogador.velocidade * dt
    end
end

-- love.keypressed() - para a√ß√µes √∫nicas
function love.keypressed(tecla)
    if tecla == "space" then
        print("Pulo!")
    end
    if tecla == "escape" then
        love.event.quit()
    end
end
```

### Sistema de Input Mais Avan√ßado

```lua
local jogador = {}

function love.load()
    jogador = {
        x = 400,
        y = 300,
        velocidade = 200,
        largura = 40,
        altura = 40
    }
end

function love.update(dt)
    -- Movimento horizontal
    if love.keyboard.isDown("right", "d") then
        jogador.x = jogador.x + jogador.velocidade * dt
    end
    if love.keyboard.isDown("left", "a") then
        jogador.x = jogador.x - jogador.velocidade * dt
    end

    -- Movimento vertical
    if love.keyboard.isDown("up", "w") then
        jogador.y = jogador.y - jogador.velocidade * dt
    end
    if love.keyboard.isDown("down", "s") then
        jogador.y = jogador.y + jogador.velocidade * dt
    end

    -- Limites da tela
    jogador.x = math.max(0, math.min(love.graphics.getWidth() - jogador.largura, jogador.x))
    jogador.y = math.max(0, math.min(love.graphics.getHeight() - jogador.altura, jogador.y))
end

function love.draw()
    love.graphics.rectangle("fill", jogador.x, jogador.y, jogador.largura, jogador.altura)

    -- Instru√ß√µes na tela
    love.graphics.print("Use WASD ou setas para mover", 10, 10)
    love.graphics.print("ESC para sair", 10, 30)
end

function love.keypressed(tecla)
    if tecla == "escape" then
        love.event.quit()
    end
end
```

## üß© 3.5 Exerc√≠cio Guiado: Jogador Completo

Vamos criar um sistema mais robusto com m√∫ltiplas funcionalidades:

```lua
local jogador = {}
local mundo = {}

function love.load()
    -- Inicializar jogador
    jogador = {
        x = 300,
        y = 300,
        velocidade = 200,
        largura = 50,
        altura = 50,
        cor = {0, 1, 0},  -- verde
        pontuacao = 0
    }

    -- Inicializar mundo
    mundo = {
        largura = love.graphics.getWidth(),
        altura = love.graphics.getHeight(),
        cor_fundo = {0.1, 0.1, 0.2}  -- azul escuro
    }

    -- Configura√ß√µes
    love.window.setTitle("Jogador Control√°vel")
end

function love.update(dt)
    -- Salvar posi√ß√£o anterior (para colis√µes futuras)
    local antiga_x = jogador.x
    local antiga_y = jogador.y

    -- Movimento do jogador
    local movendo = false

    if love.keyboard.isDown("up", "w") then
        jogador.y = jogador.y - jogador.velocidade * dt
        movendo = true
    end
    if love.keyboard.isDown("down", "s") then
        jogador.y = jogador.y + jogador.velocidade * dt
        movendo = true
    end
    if love.keyboard.isDown("left", "a") then
        jogador.x = jogador.x - jogador.velocidade * dt
        movendo = true
    end
    if love.keyboard.isDown("right", "d") then
        jogador.x = jogador.x + jogador.velocidade * dt
        movendo = true
    end

    -- Verificar limites da tela
    if jogador.x < 0 then
        jogador.x = 0
    elseif jogador.x + jogador.largura > mundo.largura then
        jogador.x = mundo.largura - jogador.largura
    end

    if jogador.y < 0 then
        jogador.y = 0
    elseif jogador.y + jogador.altura > mundo.altura then
        jogador.y = mundo.altura - jogador.altura
    end

    -- Adicionar pontos quando se move
    if movendo then
        jogador.pontuacao = jogador.pontuacao + 10 * dt
    end
end

function love.draw()
    -- Cor de fundo
    love.graphics.clear(mundo.cor_fundo)

    -- Desenhar jogador
    love.graphics.setColor(jogador.cor)
    love.graphics.rectangle("fill", jogador.x, jogador.y, jogador.largura, jogador.altura)

    -- Interface do usu√°rio
    love.graphics.setColor(1, 1, 1)  -- branco
    love.graphics.print("Posi√ß√£o: (" .. math.floor(jogador.x) .. ", " .. math.floor(jogador.y) .. ")", 10, 10)
    love.graphics.print("Pontua√ß√£o: " .. math.floor(jogador.pontuacao), 10, 30)
    love.graphics.print("Velocidade: " .. jogador.velocidade, 10, 50)

    -- Instru√ß√µes
    love.graphics.print("Controles:", 10, 100)
    love.graphics.print("WASD ou Setas - Mover", 10, 120)
    love.graphics.print("+ / - - Mudar velocidade", 10, 140)
    love.graphics.print("R - Resetar", 10, 160)
    love.graphics.print("ESC - Sair", 10, 180)

    -- Desenhar bordas da tela
    love.graphics.setColor(1, 1, 1, 0.3)  -- branco semi-transparente
    love.graphics.rectangle("line", 0, 0, mundo.largura - 1, mundo.altura - 1)
end

function love.keypressed(tecla)
    if tecla == "escape" then
        love.event.quit()
    elseif tecla == "r" then
        -- Resetar jogador
        jogador.x = 300
        jogador.y = 300
        jogador.pontuacao = 0
        print("Jogo resetado!")
    elseif tecla == "kp+" or tecla == "=" then
        -- Aumentar velocidade
        jogador.velocidade = jogador.velocidade + 50
        print("Velocidade: " .. jogador.velocidade)
    elseif tecla == "kp-" or tecla == "-" then
        -- Diminuir velocidade
        jogador.velocidade = math.max(50, jogador.velocidade - 50)
        print("Velocidade: " .. jogador.velocidade)
    end
end
```

## üß† 3.6 Boas Pr√°ticas

### 1. Use Vari√°veis Locais

```lua
-- ‚ùå Vari√°vel global
jogador = {x = 100, y = 100}

-- ‚úÖ Vari√°vel local
local jogador = {x = 100, y = 100}
```

### 2. Separe L√≥gica e Renderiza√ß√£o

```lua
-- ‚ùå Misturado
function love.update(dt)
    x = x + 100 * dt
    love.graphics.circle("fill", x, y, 20)  -- n√£o desenhe no update!
end

-- ‚úÖ Separado
function love.update(dt)
    x = x + 100 * dt  -- apenas l√≥gica
end

function love.draw()
    love.graphics.circle("fill", x, y, 20)  -- apenas renderiza√ß√£o
end
```

### 3. Comente o C√≥digo

```lua
function love.load()
    -- Configura√ß√µes iniciais do jogador
    jogador = {
        x = 100,           -- posi√ß√£o horizontal
        y = 100,           -- posi√ß√£o vertical
        velocidade = 150   -- pixels por segundo
    }
end
```

### 4. Use Nomes Descritivos

```lua
-- ‚ùå Nomes confusos
local p = {x = 100, y = 100, v = 150}

-- ‚úÖ Nomes claros
local jogador = {x = 100, y = 100, velocidade = 150}
```

### 5. Organize em Fun√ß√µes

```lua
function atualizarJogador(dt)
    if love.keyboard.isDown("right") then
        jogador.x = jogador.x + jogador.velocidade * dt
    end
end

function desenharJogador()
    love.graphics.rectangle("fill", jogador.x, jogador.y, 50, 50)
end

function love.update(dt)
    atualizarJogador(dt)
end

function love.draw()
    desenharJogador()
end
```

## üìä 3.7 Estrutura de Projeto Recomendada

```lua
-- main.lua - arquivo principal
local jogador = require("jogador")
local mundo = require("mundo")

function love.load()
    jogador.inicializar()
    mundo.inicializar()
end

function love.update(dt)
    jogador.atualizar(dt)
    mundo.atualizar(dt)
end

function love.draw()
    mundo.desenhar()
    jogador.desenhar()
end
```

## ‚úÖ Conclus√£o do Cap√≠tulo

Voc√™ aprendeu:

-   Como funciona o ciclo de vida de um jogo em L√ñVE2D
-   A import√¢ncia do delta time para movimento suave
-   Como usar `love.load`, `love.update` e `love.draw` efetivamente
-   Como implementar controles responsivos com teclado
-   Como organizar c√≥digo de forma limpa e manuten√≠vel
-   Boas pr√°ticas para desenvolvimento de jogos

## üí° Conceitos Importantes

-   **Delta Time**: Sempre use `dt` para movimento baseado em tempo
-   **Separa√ß√£o de Responsabilidades**: Load, Update, Draw t√™m fun√ß√µes espec√≠ficas
-   **Input Handling**: Use `isDown()` para a√ß√µes cont√≠nuas e `keypressed()` para eventos √∫nicos
-   **Limites de Tela**: Sempre verifique bordas para evitar que objetos saiam da tela
